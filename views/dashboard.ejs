<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="<%= darkMode ? 'dark' : '' %>">

<header class="header">
  <form action="/toggle-darkmode" method="POST" class="dark-toggle-form">
    <button type="submit" class="dark-toggle-btn">ğŸŒ™</button>
  </form>
</header>

<main class="dashboard-container">
  <h1>Hola, <%= currentUser %> ğŸ‘‹</h1>

  <form action="/generate" method="POST" class="generate-form">
    <input type="text" name="originalUrl" placeholder="Introduce la URL" required class="input-large" />
    <button type="submit" class="btn btn-primary">Generar QR</button>
  </form>

  <div class="qr-list">
    <% qrs.forEach(qr => { %>
      <div class="qr-card">
        <img src="<%= qr.qrDataUrl %>" alt="QR">
        <p><strong>URL destino:</strong> <%= qr.originalUrl %></p>
        <p><strong>URL acortada:</strong> <%= qr.shortInternalUrl %></p>
        <p><strong>Ãšltimo escaneo:</strong> <%= qr.lastScan ? qr.lastScan.toLocaleString("es-VE", { timeZone: "America/Caracas" }) : "Nunca" %></p>
        <p><strong>Escaneos:</strong> <%= qr.scans %></p>

        <form action="/update/<%= qr.id %>" method="POST" class="update-form">
          <input type="text" name="originalUrl" placeholder="Nueva URL" required class="input-large" />
          <button type="submit" class="btn btn-primary">Actualizar</button>
        </form>

        <form action="/delete/<%= qr.id %>" method="POST" class="delete-form">
          <button type="submit" class="btn btn-danger">Eliminar QR</button>
        </form>
      </div>
    <% }) %>
  </div>

  <div class="bottom-links">
    <a href="/change-password" class="link">Cambiar contraseÃ±a</a>
    <form action="/delete-account" method="POST" onsubmit="return confirm('Â¿Eliminar cuenta y todos los QR?')">
      <button type="submit" class="btn btn-danger">Eliminar cuenta</button>
    </form>
    <a href="/logout" class="btn btn-primary">Cerrar sesiÃ³n</a>
  </div>
</main>

</body>
</html>
