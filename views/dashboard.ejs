<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Panel - QR Manager Pro</title>
  <link rel="stylesheet" href="/css/style.css" />
  <script defer src="/js/dark-mode.js"></script>
</head>
<body class="<%= darkMode ? 'dark-mode' : '' %>">
  <div class="container">
    <div class="card dashboard">

      <!-- üîù Header con men√∫ hamburguesa -->
      <div class="header">
        <div class="brand">QR Manager Pro</div>

        <!-- Bot√≥n de dark mode siempre visible -->
        <button class="btn small" data-toggle-dark>
          <%= darkMode ? 'Light Mode' : 'Dark Mode' %>
        </button>

        <!-- Men√∫ hamburguesa -->
        <div class="menu-wrapper">
          <button class="menu-btn" id="menu-toggle" aria-label="Abrir men√∫">
            ‚ò∞
          </button>
          <div class="menu-dropdown" id="menu-dropdown">
            <a href="/change-password">Cambiar contrase√±a</a>
            <a href="/logout">Cerrar sesi√≥n</a>
            <form action="/delete-account" method="POST" onsubmit="return confirm('¬øSeguro que deseas eliminar tu cuenta? Esta acci√≥n no se puede deshacer.')">
              <button type="submit" class="danger-link">Eliminar cuenta</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Crear nuevo QR -->
      <div class="create-qr">
        <form action="/create" method="POST" style="display:flex; width:100%; gap:10px;">
          <input type="url" name="originalUrl" placeholder="Ingresa la URL a acortar y generar QR" required />
          <button class="btn" type="submit">Crear QR</button>
        </form>
      </div>

      <!-- Lista de QRs -->
      <div class="qr-grid">
        <% qrs.forEach(qr => { %>
          <div class="qr-card">
            <div class="qr-preview">
              <img src="<%= qr.qrImageUrl %>" alt="QR Code" />
            </div>
            <div class="qr-data">
              <p><strong>Redirige a:</strong> <%= qr.originalUrl %></p>
              <p><strong>URL acortada (fija):</strong> <%= qr.shortUrl %></p>
              <p><strong>Escaneos:</strong> <%= qr.scans %> ‚Äî <strong>√öltimo:</strong> <%= qr.lastScan || 'Nunca' %></p>

              <!-- Actualizar URL -->
              <form class="inline-update" action="/update/<%= qr._id %>" method="POST">
                <input type="url" name="newUrl" placeholder="Nueva URL (no cambiar√° el QR)" required />
                <button class="btn small" type="submit">Actualizar</button>
              </form>

              <!-- Eliminar QR -->
              <form class="inline-update" action="/delete/<%= qr._id %>" method="POST" onsubmit="return confirm('¬øSeguro que deseas eliminar este QR?')">
                <button class="btn small danger" type="submit">Eliminar QR</button>
              </form>
            </div>
          </div>
        <% }) %>
      </div>

    </div>
  </div>

  <script>
    // Toggle dropdown
    const toggleBtn = document.getElementById("menu-toggle");
    const dropdown = document.getElementById("menu-dropdown");
    toggleBtn.addEventListener("click", () => {
      dropdown.classList.toggle("show");
    });

    // Cierra el dropdown si se hace clic fuera
    document.addEventListener("click", (e) => {
      if (!toggleBtn.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.classList.remove("show");
      }
    });
  </script>
</body>
</html>
